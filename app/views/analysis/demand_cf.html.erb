<script src="/assets/jquery.flot/jquery.flot.js" type="text/javascript"></script>
<script>
// function chart_search( hash, page ){
     // if (page==null)   	page=0;
	// $.post("./data_analysis",{ partNr: hash["partNr"], options: hash, page: page },
			  // function(data){ $('#result').html(data); },
			  // "html");
// }
// $(function (){
	// $('#partNr_float > input.startsearch').click(function(){ chart_search( {partNr:$('#partNr_float > input[placeholder]').val()} );    });
// })
</script>

<div id="charting" style="position:absolute; top:150px; left:450px; width:600px;height:300px;">
	<div style="position:absolute; top:100px; left:130px"><h1>CHARTING HISTORY</h1></div>
</div>

<div id="search_expired_vertical_bar" style="position: fixed; top: 100px; left: 120px">
	<% if session[:orgOpeType]==OrgOperateType::Client %>
		<div class="textsearchbox texts" id="supplier_float" style="position: relative">
		     <span class="searchcontenttype">供应商号</span>
		     <input type="text" name="searchcontent" class="searchcontent" placeholder="请输入供应商号" />
		</div>
	<% else %>
		<div class="textsearchbox texts" id="client_float" style="position: relative">
		     <span class="searchcontenttype">客户号</span>
		     <input type="text" name="searchcontent" class="searchcontent" placeholder="请输入客户号" />
		</div>
	<% end %>
	<div class="textsearchbox texts" id="partNr_float" style="position: relative">
	     <span class="searchcontenttype">零件号</span>
	     <input type="text" name="searchcontent" class="searchcontent" placeholder="请输入零件号" />
	</div>
	<div class="textsearchbox ranges" id="date_float" style="position: relative">
	     <span class="searchcontenttype ">日期</span>
	     <input type="text" name="searchcontent" class="searchcontent" placeholder="请选择开始时间" />
	     <input type="text" name="searchcontent" class="searchcontent" placeholder="请选择结束时间" />
	</div>
	<div class="textsearchbox texts" id="type_float" style="position: relative">
	     <span class="searchcontenttype ">预测类型</span>
	     <input type="button"	name="searchtype" class="searchforcasttype" value="D" />
	     <input type="button" name="searchtype" class="searchforcasttype"	value="W" />
	     <input type="button" name="searchtype" class="searchforcasttype"	value="M" />
	     <input type="button" name="searchtype"	class="searchforcasttype" value="Y" />
	     <input type="button"	name="searchtype" class="searchforcasttype" value="T" />
	</div>
	<div id="search_expired_button" style="position: relative">
		<input type="button" name="cancel" class="startsearch" value="取消" />
		<input type="button" name="search" class="startsearch" value="搜索" />
	</div>
</div>


<div id='result' class="tableview" style="clear: left"></div>
<script type="text/javascript">
///////////////////////////////////////////////////////////////////	        ext     search
function get_demand_label() {
     var label = {
          // client: [],
          // supplier: [],
          // partNr: [],
          // // start: hash["start"],
          // // end: hash["end"],
          // type: [],
     }
     label.client = $('#client_float > input.startsearch').val();
     label.supplier = $('#supplier_float > input.searchcontent').val();
     label.partNr = $("#partNr_float > input.searchcontent").val();
     label.start = $("#date_float > input").get(0).value;
     label.end = $("#date_float > input").get(1).value;
     label.type = $('.activetype').get(0).value;
     return label;
}

function chart_cf( hash ){
	$.post("./demand_cf",
			{
               client : hash["client"],
               supplier : hash["supplier"],
               partNr : hash["partNr"],
               start : hash["start"],
               end : hash["end"],
               type : hash["type"],
            },
			function(data){  
				if (data.flag){
				  	var charting = $('#charting');
				  	$.plot($(charting),  [
				  		{ data:data.chart, lines: {show: true, fill: true}, points: {show: true}, color : '#71c73e' }
				  	], {
				  		xaxis:{ min:0, max:7, ticks:data.x, tickColor : 'transparent', },
				  		yaxis:{ min:0 },
						grid: {
							borderWidth: 1,
							minBorderMargin: 20,
							labelMargin: 10,
							backgroundColor: {	colors: ["#fff", "#e4f4f4"] 	},
							hoverable: true,
							mouseActiveRadius: 50,
							margin: {	top: 8,	bottom: 20,		left: 20	}
						}
				  	});
			        var yaxisLabel = $("<div>").text("零件： " + data.partNr).appendTo(charting);
			        yaxisLabel.css("position", "absolute").css('top', '-10%').css('width', '600px').css("text-align", 'center');
				 }else
				 	MessageBox(data.msg);
			},"json");
}
///////////////////////////////////////////////////////////////////         DOM  on   ready
$(function() {
     $('#type_float > input.searchforcasttype').click(function(){ $(this).toggleClass('activetype'); });
     $('#search_expired_button > input[name=search]').click(function() {
          var label = get_demand_label();
          chart_cf(label);
     });
     $('#search_expired_button > input[name=cancel]').click(function() {
          $('input.searchcontent').val("");
          $('.activetype').removeClass("activetype");
     });

     $('#date_float > input[placeholder*=开始]').datepicker({
          showButtonPanel : true
     });
     $('#date_float > input[placeholder*=结束]').datepicker({
          showButtonPanel : true
     });

     $('#client_float > input.searchcontent').autocomplete({
          source : "/organisation_manager/redis_search",
          appendTo : "#client_float"
     });
     $('#supplier_float > input.searchcontent').autocomplete({
          source : "/organisation_manager/redis_search",
          appendTo : "#supplier_float"
     });
     $("#partNr_float > input.searchcontent").autocomplete({
          source : "/part/redis_search",
          appendTo : "#partNr_float"
     });
});

</script>

