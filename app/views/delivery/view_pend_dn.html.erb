<link rel="stylesheet"  type="text/css" href="/assets/delivery/supWaybill.css" />
<link rel="stylesheet" type="text/css" href="/assets/delivery/supCheckbill.css"/>
<script src="/assets/deliery-send-receive.js" type="text/javascript"></script>
<script type="text/javascript">
	$(document).ready(function () {
   $('#sendDate-text').datepicker({
          showButtonPanel : true
     });
	});
</script>
<%if @msg.result%>
<% dn=@msg.object%>
 
<div class="fillindestinations">
	<p>
		运单发送预览数据: <%= dn.key%>
	</p>
	<span class="errparts" style="display:none;">*请先填写正确的送货地址或送货时间</span></br>
	<div class="fillind">
		<input type="text" class="fillindest"id="client-text" autocomplete="off" disabled="false"  style="width: 150px"
		value="<%= DeliveryHelper.get_clientNr_by_orgId(dn.organisation_id,dn.rece_org_id)%>"
		disabled/>
		<form method="post" id="gen_dn_pdf_form" action="../delivery/gen_dn_pdf">
			<input type="hidden" value="<%= dn.key%>" id="dnkey-hidden" name="dnKey">
			<input type="text" class="fillindest fillindestlonger" name="destination" 
			 value="<%= dn.destination.length==0? DeliveryHelper.get_dn_rece_address(dn.organisation_id,dn.rece_org_id):dn.destination%>"
			placeholder="请您填写送货地址-必填" id="destination-text" style="width: 250px">
			<input type="text" class="fillindest fillindestlonger" name="sendDate"
			placeholder="请您填写送货日期-必填" id="sendDate-text"  style="width: 150px" value="<%=dn.sendDate.nil? ? Time.now.strftime('%Y/%m/%d'):Time.at(dn.sendDate.to_i).strftime('%Y/%m/%d')%>">
		</form>
	</div>
</div>
<div id='delivery-items-div'>
	<%= render :partial=>'dn_pend_items',:locals=>{:dnItems=>dn.items}%>
</div>
<div class="botbts">
	<div class="btprintdn botbtn" onclick="generate_dn_label_pdf(100);">
		<p>
			打印运单
		</p>
	</div>
	 <div class="btprintdnbox botbtn" onclick="add_dn_to_print_queue();">
		<p>
			打印包装箱
		</p>
	</div>
	<div class="btcancel botbtn" id="cancelDeliverySendBtn" onclick="cancel_staff_dn();">
		<p>
			取消
		</p>
	</div>
	<div class="btsend botbtn" onclick="send_staff_dn(this);">
		<p>
			发送
		</p>
	</div>
</div>
<%= render :partial => "shared/handling_msg_box", :locals => { :handlemsg => "正在处理中，请稍后..." } %>
<%else%>
<div class="abstractblock">
	<%= @msg.content%>
</div>
<%end%>