
	<table class="upData">
		<tr class="lineone">
			<% if session[:orgOpeType]==OrgOperateType::Client %>
				<th link="supplier_float" style="cursor: pointer" onclick="pop(this);">供应商号</th>
			<% else %>
				<th link="client_float" style="cursor: pointer" onclick="pop(this);">客户号</th>
			<% end %>
			<th link="partNr_float" style="cursor: pointer" onclick="pop(this);">零件号</th>
			<th link="date_float" style="cursor: pointer" onclick="pop(this);">日期</th>
			<th link="amount_float" style="cursor: pointer" onclick="pop(this);">数量</th>
			<th link="type_float" style="cursor: pointer" onclick="pop(this);">预测类型</th>
			<th link="rate_float" style="cursor: pointer" onclick="pop(this);">变动量</th>
		</tr>
		<tr class="divide" style="display: none">
			<th class="nordvd"></th>
			<th class="nordvd"></th>
			<th class="nordvd"></th>
			<th class="nordvd"></th>
			<th class="nordvd"></th>
			<th class="lastdvd"></th>
		</tr>
		<% @demands.each do |d|
	   thisLineWidth=lastLineWidth=nil
          img=nil
          if d.oldamount.nil?
          img='dotchecked'
          thisLineWidth=100
          lastLineWidth=0
          else
          if d.rate.to_i>0
          img='arrup'
          thisLineWidth=100
          lastLineWidth= d.oldamount>0 ? 100/(1+d.rate.to_f/100) : 0
          elsif d.rate.to_i<0
          img='arrdown'
          thisLineWidth=(100+d.rate.to_f)
          lastLineWidth=100
          else
          img='equal'
          thisLineWidth=d.amount>0 ? 100 : 0
          lastLineWidth=d.oldamount>0 ? 100 : 0
          end
          end
		%>
		  <tr class="norline hoverable">
			<% if session[:orgOpeType]==OrgOperateType::Client %>
				<th><%= d.supplierNr %></th>
				<th><%= d.cpartNr%></th>
			<% else %>
				<th><%= d.clientNr %></th>
				<th><%= d.spartNr%></th>
			<% end %>
			
			<th><%= d.date%></th>
			<th><%= d.amount%></th>
			<th><%= d.type%></th>
			<th>  
	               <div class="forcastcompare">
	                     <div class="lineforcast">
                         <% if d.oldamount.nil?%>
                         <span class="percentage"> new </span>
                         <% else %>
                         <span class="percentage"> <%= d.rate.to_f.round(2).abs %>% </span>
                         <% end %>
                         <img src="/assets/<%= img%>.png" class='percentageImg' />
                    </div>
	                    <div class="lineforcast">
	                         <span class="fnumbers">本次预测：<span id="this_demand_amount"><%= d.amount %></span></span>
	                         <div class="forcastbaseline">
	                              <div class="partline" style="width:<%= thisLineWidth%>%" id='thisLineWidthDiv'></div>
	                              <div class="gap"></div>
	                         </div>
	                    </div>
	                    <div class="lineforcast">
	                         <span class="fnumbers">上次预测：<%= d.oldamount %></span>
	                         <div class="forcastbaseline">
	                              <div class="partline" style="width:<%= lastLineWidth%>%" id='lastLineWidthDiv'></div>
	                         </div>
	                    </div>
	               </div>
			</th>
			<th>  <input type="button" value="Chart" onclick="chart_history('<%= d.key%>');" />
		  </tr>
		<% end %>
	</table>
	<hr/>
	There is(are) <%= @total %> record(s):<br/>
	<%=bri_pager options={:class=>"pagination",:pages=>@totalPages,:current=>@currentPage,:action=>'demand_search',:target=>@options}%>